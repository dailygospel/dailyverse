<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>✝️</text></svg>">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Daily Verse</title>
    
    <style>
        :root {
            /* Restored the slightly darker glass for contrast */
            --glass-bg: rgba(20, 20, 20, 0.65);
            --glass-border: rgba(255, 255, 255, 0.15);
            --text-color: #f0f0f0;
            --accent: #ffd700;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            /* Restored original font stack */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #1a1a1a;
            background-size: cover;
            background-position: center;
            transition: background-image 1s ease-in-out;
            overflow: hidden;
            color: var(--text-color);
        }

        /* Dynamic Overlays */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.3);
            z-index: 1;
            transition: background 1s ease;
        }
        
        .overlay.night-mode {
            background: rgba(0,0,0,0.65);
        }

        /* Top Bar (Just Mood Selector now) */
        .top-bar {
            position: absolute;
            top: 20px;
            width: 100%;
            display: flex;
            justify-content: center; /* Centered since streak is gone */
            z-index: 20;
        }

        select.mood-selector {
            background: rgba(0,0,0,0.5);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 30px;
            font-family: inherit;
            font-size: 0.85rem;
            cursor: pointer;
            backdrop-filter: blur(5px);
        }
        
        select.mood-selector option { background: #333; color: white; }

        /* Main Card */
        .card {
            position: relative;
            z-index: 10;
            width: 90%;
            max-width: 650px;
            padding: 50px 40px;
            border-radius: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 25px;
            animation: fadeIn 0.8s ease-out;
        }

        /* Heart Icon */
        .fav-btn {
            position: absolute;
            top: 25px;
            right: 25px;
            background: none;
            border: none;
            cursor: pointer;
            color: rgba(255,255,255,0.4);
            transition: transform 0.2s, color 0.2s;
        }
        .fav-btn:hover { transform: scale(1.1); }
        .fav-btn.active { color: #ff6b6b; }

        h1 {
            font-size: 0.85rem;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: rgba(255,255,255,0.6);
            margin-bottom: 5px;
        }

        #verse-text {
            /* Restored Georgia for the verse text */
            font-family: 'Georgia', serif;
            font-size: 1.6rem;
            line-height: 1.5;
            min-height: 80px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        #verse-reference {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--accent);
            letter-spacing: 1px;
        }

        /* Controls */
        .buttons {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        button.action-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 22px;
            border-radius: 50px; /* Round buttons back */
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        button.action-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* Refresh Button (Subtle) */
        .refresh-container {
            margin-top: 10px;
        }
        .refresh-text {
            font-size: 0.75rem;
            color: rgba(255,255,255,0.4);
            text-decoration: underline;
            cursor: pointer;
            background: none;
            border: none;
            padding: 5px;
        }
        .refresh-text:hover { color: #fff; }

        /* Floating UI Elements */
        .sound-toggle, .view-favs-btn {
            position: fixed;
            bottom: 20px;
            z-index: 20;
            background: rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            width: 45px; height: 45px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .sound-toggle:hover, .view-favs-btn:hover { background: rgba(0,0,0,0.8); }

        .sound-toggle { left: 20px; }
        .view-favs-btn { left: 75px; }

        .footer-note {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            z-index: 20;
            font-style: italic;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 100;
            justify-content: center; align-items: center;
        }
        .modal {
            background: #222;
            width: 90%; max-width: 500px; max-height: 80vh;
            padding: 30px;
            border: 1px solid #444;
            border-radius: 10px;
            overflow-y: auto;
            position: relative;
            color: #eee;
        }
        .close-modal {
            position: absolute; top: 10px; right: 15px;
            font-size: 1.5rem; color: #888; cursor: pointer;
        }
        .fav-item {
            border-bottom: 1px solid #444;
            padding: 15px 0;
            text-align: left;
        }
        .fav-remove {
            color: #ff6b6b; font-size: 0.75rem; cursor: pointer; margin-top: 8px; display: inline-block;
        }

        /* Loader */
        .spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid #fff;
            border-radius: 50%;
            width: 30px; height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        /* Responsive */
        @media (max-width: 600px) {
            .card { padding: 30px 20px; width: 95%; }
            #verse-text { font-size: 1.35rem; }
            .buttons { flex-direction: column; align-items: stretch; }
            button.action-btn { justify-content: center; }
            .footer-note { bottom: 10px; right: 0; width: 100%; text-align: center; }
            .sound-toggle { bottom: 60px; left: 20px; }
            .view-favs-btn { bottom: 115px; left: 20px; }
        }
    </style>
</head>
<body>

    <div class="overlay" id="bg-overlay"></div>

    <div class="top-bar">
        <select class="mood-selector" id="mood-select" onchange="changeMood()">
            <option value="random">Daily Random</option>
            <option value="anxiety">Anxiety</option>
            <option value="peace">Peace</option>
            <option value="strength">Strength</option>
            <option value="hope">Hope</option>
        </select>
    </div>

    <div class="card">
        <button class="fav-btn" id="fav-btn" onclick="toggleFavorite()">
            <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
        </button>

        <h1>Daily Verse</h1>
        
        <div id="verse-text">
            <div class="spinner"></div>
        </div>
        
        <div id="verse-reference"></div>

        <div class="buttons">
            <button class="action-btn" onclick="speakVerse()">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>
                Read Aloud
            </button>
            <button class="action-btn" onclick="openChapter()">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                Read Chapter
            </button>
            <button class="action-btn" onclick="shareVerse()">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>
                Share
            </button>
        </div>

        <div class="refresh-container">
            <button class="refresh-text" onclick="forceNewVerse()">Get New Verse</button>
            <div id="timer-display" style="font-size: 0.7rem; margin-top: 5px; opacity: 0.6;"></div>
        </div>
    </div>

    <button class="sound-toggle" onclick="toggleSound()" title="Toggle Ambience">
        <svg id="sound-icon" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>
    </button>
    <button class="view-favs-btn" onclick="openFavModal()" title="View Favorites">
        <svg width="22" height="22" fill="currentColor" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
    </button>

    <div class="footer-note">Made with love by Mason</div>

    <div class="modal-overlay" id="fav-modal">
        <div class="modal">
            <div class="close-modal" onclick="closeFavModal()">&times;</div>
            <h2 style="border-bottom:1px solid #444; padding-bottom:10px; margin-bottom:10px;">Your Favorites</h2>
            <div id="fav-list"></div>
        </div>
    </div>

    <audio id="ambient-audio" loop>
        <source src="https://cdn.pixabay.com/audio/2022/05/27/audio_1808fbf07a.mp3" type="audio/mpeg">
    </audio>

    <script>
        // CONFIG
        const REFRESH_HOURS = 12;
        const BG_KEYWORDS = ['forest', 'mountain', 'lake', 'fog', 'stars', 'ocean'];
        
        // MOOD LIBRARY
        const MOODS = {
            anxiety: [
                {t: "Cast all your anxiety on him because he cares for you.", r: "1 Peter 5:7"},
                {t: "Peace I leave with you; my peace I give to you. Not as the world gives do I give to you. Let not your hearts be troubled, neither let them be afraid.", r: "John 14:27"},
                {t: "When I am afraid, I put my trust in you.", r: "Psalm 56:3"}
            ],
            peace: [
                {t: "The LORD is my shepherd; I shall not want. He makes me lie down in green pastures.", r: "Psalm 23:1-2"},
                {t: "You keep him in perfect peace whose mind is stayed on you, because he trusts in you.", r: "Isaiah 26:3"}
            ],
            strength: [
                {t: "I can do all things through him who strengthens me.", r: "Philippians 4:13"},
                {t: "But they who wait for the LORD shall renew their strength.", r: "Isaiah 40:31"}
            ],
            hope: [
                {t: "For I know the plans I have for you, declares the LORD, plans for welfare and not for evil, to give you a future and a hope.", r: "Jeremiah 29:11"},
                {t: "Rejoice in hope, be patient in tribulation, be constant in prayer.", r: "Romans 12:12"}
            ]
        };

        // ELEMENTS
        const verseTextEl = document.getElementById('verse-text');
        const verseRefEl = document.getElementById('verse-reference');
        const favBtn = document.getElementById('fav-btn');
        const soundIcon = document.getElementById('sound-icon');
        let currentVerse = {};

        function init() {
            setRandomBackground();
            checkNightMode();
            handleVerseLogic();
            window.speechSynthesis.getVoices();
        }

        // --- 1. BACKGROUND & THEME ---
        function setRandomBackground() {
            const keyword = BG_KEYWORDS[Math.floor(Math.random() * BG_KEYWORDS.length)];
            const seed = Math.floor(Math.random() * 9999);
            const url = `https://picsum.photos/seed/${seed}/1920/1080?${keyword}`;
            const img = new Image();
            img.src = url;
            img.onload = () => document.body.style.backgroundImage = `url('${url}')`;
        }

        function checkNightMode() {
            const h = new Date().getHours();
            if (h >= 20 || h < 6) {
                document.getElementById('bg-overlay').classList.add('night-mode');
            }
        }

        // --- 2. VERSE LOGIC ---
        async function handleVerseLogic() {
            const mood = document.getElementById('mood-select').value;

            // If a specific mood is selected, bypass the API and Timer
            if (mood !== 'random') {
                loadMoodVerse(mood);
                return;
            }

            // Standard "Daily Random" Logic
            const now = Date.now();
            const storedData = localStorage.getItem('dailyVerseData');
            const storedTime = localStorage.getItem('dailyVerseTime');

            if (storedData && storedTime && (now - storedTime < REFRESH_HOURS * 60 * 60 * 1000)) {
                const data = JSON.parse(storedData);
                displayVerse(data);
                startTimer(parseInt(storedTime));
            } else {
                await fetchNewVerse();
            }
        }

        async function fetchNewVerse() {
            verseTextEl.innerHTML = '<div class="spinner"></div>';
            verseRefEl.textContent = '';
            
            try {
                const response = await fetch('https://bible-api.com/?random=verse&translation=web');
                const data = await response.json();
                const cleanText = data.text.replace(/\n/g, ' ').trim();
                const verseData = { text: cleanText, reference: data.reference };
                
                // Save only if we are in random mode
                if(document.getElementById('mood-select').value === 'random') {
                    localStorage.setItem('dailyVerseData', JSON.stringify(verseData));
                    localStorage.setItem('dailyVerseTime', Date.now());
                    startTimer(Date.now());
                }
                
                displayVerse(verseData);
            } catch (e) {
                console.error(e);
                verseTextEl.textContent = "Offline Mode: Trust in the LORD with all your heart.";
                verseRefEl.textContent = "Proverbs 3:5";
                currentVerse = { text: verseTextEl.textContent, reference: verseRefEl.textContent };
            }
        }

        function loadMoodVerse(mood) {
            const options = MOODS[mood];
            const randomPick = options[Math.floor(Math.random() * options.length)];
            displayVerse({ text: randomPick.t, reference: randomPick.r });
            document.getElementById('timer-display').textContent = ""; 
        }

        function displayVerse(data) {
            currentVerse = data;
            verseTextEl.textContent = `"${data.text}"`;
            verseRefEl.textContent = data.reference;
            updateFavIcon();
        }

        function forceNewVerse() {
            const mood = document.getElementById('mood-select').value;
            if (mood === 'random') {
                localStorage.removeItem('dailyVerseTime');
                fetchNewVerse();
            } else {
                loadMoodVerse(mood);
            }
            setRandomBackground(); 
        }

        function changeMood() {
            forceNewVerse();
        }

        // --- 3. FEATURES ---
        function openChapter() {
            const ref = verseRefEl.textContent; 
            if (!ref) return;
            // Split verse from chapter (e.g. John 3:16 -> John 3)
            let chapterRef = ref.includes(':') ? ref.split(':')[0] : ref;
            const url = `https://www.biblegateway.com/passage/?search=${encodeURIComponent(chapterRef)}&version=ESV`;
            window.open(url, '_blank');
        }

        function speakVerse() {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(`${currentVerse.reference}. ${currentVerse.text}`);
            let voices = window.speechSynthesis.getVoices();
            // Human-like voice selection
            let v = voices.find(v => v.name.includes("Google US English")) || 
                    voices.find(v => v.name.includes("Samantha")) || 
                    voices.find(v => v.name.includes("Zira"));
            if (v) u.voice = v;
            u.rate = 0.85; u.pitch = 0.95;
            window.speechSynthesis.speak(u);
        }

        function shareVerse() {
            const str = `${currentVerse.text} - ${currentVerse.reference}`;
            if (navigator.share) {
                navigator.share({ title: 'Daily Verse', text: str });
            } else {
                navigator.clipboard.writeText(str);
                alert("Copied to clipboard!");
            }
        }

        // --- 4. FAVORITES SYSTEM ---
        function toggleFavorite() {
            let favs = JSON.parse(localStorage.getItem('favVerses') || '[]');
            const exists = favs.find(v => v.reference === currentVerse.reference);
            
            if (exists) {
                favs = favs.filter(v => v.reference !== currentVerse.reference);
            } else {
                favs.push(currentVerse);
            }
            
            localStorage.setItem('favVerses', JSON.stringify(favs));
            updateFavIcon();
            renderFavList();
        }

        function updateFavIcon() {
            let favs = JSON.parse(localStorage.getItem('favVerses') || '[]');
            const exists = favs.find(v => v.reference === currentVerse.reference);
            if (exists) favBtn.classList.add('active');
            else favBtn.classList.remove('active');
        }

        function openFavModal() {
            renderFavList();
            document.getElementById('fav-modal').style.display = 'flex';
        }

        function closeFavModal() {
            document.getElementById('fav-modal').style.display = 'none';
        }

        function renderFavList() {
            const list = document.getElementById('fav-list');
            let favs = JSON.parse(localStorage.getItem('favVerses') || '[]');
            list.innerHTML = '';
            if (favs.length === 0) {
                list.innerHTML = '<p style="color:#666; font-style:italic;">No favorites yet.</p>';
                return;
            }
            favs.forEach((v) => {
                const div = document.createElement('div');
                div.className = 'fav-item';
                div.innerHTML = `
                    <div style="font-size:0.9rem; margin-bottom:5px;">"${v.text}"</div>
                    <div style="color:var(--accent); font-size:0.8rem; font-weight:bold;">${v.reference}</div>
                    <div class="fav-remove" onclick="removeFav('${v.reference}')">Remove</div>
                `;
                list.appendChild(div);
            });
        }

        function removeFav(ref) {
            let favs = JSON.parse(localStorage.getItem('favVerses') || '[]');
            favs = favs.filter(v => v.reference !== ref);
            localStorage.setItem('favVerses', JSON.stringify(favs));
            renderFavList();
            updateFavIcon();
        }

        // --- 5. SOUND & TIMER ---
        let isPlaying = false;
        function toggleSound() {
            const audio = document.getElementById('ambient-audio');
            if (isPlaying) {
                audio.pause();
                soundIcon.style.opacity = "0.5";
            } else {
                audio.volume = 0.3;
                audio.play().catch(e => alert("Interact with the page first to play audio."));
                soundIcon.style.opacity = "1";
            }
            isPlaying = !isPlaying;
        }

        function startTimer(startTime) {
            const el = document.getElementById('timer-display');
            const update = () => {
                const diff = (startTime + (REFRESH_HOURS * 3600000)) - Date.now();
                if (diff <= 0) { el.textContent = "Time for new verse"; return; }
                const h = Math.floor(diff / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                el.textContent = `Next daily verse: ${h}h ${m}m`;
            };
            update();
            setInterval(update, 60000);
        }

        init();
    </script>
</body>

</html>



